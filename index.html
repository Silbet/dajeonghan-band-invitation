<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GROOVE MUSIC LIVE 2026</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts (Pretendard style) -->
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    
    <style>
        /* [ë””ìì¸ ì»¤ìŠ¤í…€: ë‹¤í¬ ëª¨ë“œ & ëª¨ë°”ì¼ ìµœì í™”] */
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            padding-bottom: 50px;
        }
        .container {
            max-width: 500px; /* ëª¨ë°”ì¼ ë·°ì— ìµœì í™”ëœ ë„ˆë¹„ */
        }
        /* í¬ìŠ¤í„° ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .poster-wrapper {
            position: relative;
            width: 100%;
            border-radius: 0 0 20px 20px;
            overflow: hidden;
            /* margin-bottom: 30px; -> fade-in-sectionì˜ ë§ˆì§„(80px)ìœ¼ë¡œ ëŒ€ì²´ */
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.1);
        }
        .poster-img {
            width: 100%;
            display: block;
        }
        
        /* ì„¹ì…˜ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .section-title {
            font-weight: 800;
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: #ffffff;
            border-left: 4px solid #6c5ce7; /* í¬ì¸íŠ¸ ì»¬ëŸ¬ */
            padding-left: 10px;
        }
        .info-box {
            background-color: #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #333;
        }
        
        /* í¼ ìš”ì†Œ ì»¤ìŠ¤í…€ */
        .form-control, .form-select {
            background-color: #2d2d2d;
            border: 1px solid #444;
            color: #fff;
            border-radius: 8px;
        }
        .form-control:focus, .form-select:focus {
            background-color: #2d2d2d;
            color: #fff;
            border-color: #6c5ce7;
            box-shadow: 0 0 0 0.25rem rgba(108, 92, 231, 0.25);
        }

        /* Placeholder(ì…ë ¥ ì „ ì•ˆë‚´ ë¬¸êµ¬) ìƒ‰ìƒ ë°ê²Œ ë³€ê²½ */
        .form-control::placeholder {
            color: #cccccc !important; 
            opacity: 1;
        }
        
        /* ì•ˆë‚´ì‚¬í•­ ê°•ì¡° */
        .notice-list li {
            margin-bottom: 8px;
            font-size: 0.95rem;
            color: #000000;
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-primary {
            background-color: #6c5ce7;
            border: none;
            padding: 12px;
            font-weight: bold;
            border-radius: 8px;
        }
        .btn-primary:hover {
            background-color: #5b4cc4;
        }
        
        /* ë„¤ì´ë²„ ì§€ë„ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-naver {
            background-color: #03C75A;
            color: #ffffff;
            font-weight: bold;
            border: none;
        }
        .btn-naver:hover {
            background-color: #02b351;
            color: #ffffff;
        }
        
        /* ë°©ëª…ë¡ ì¹´ë“œ */
        .guestbook-card {
            background-color: #1a1a1a;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #444;
            transition: transform 0.2s;
        }
        .guestbook-card:hover {
            border-left: 3px solid #6c5ce7;
        }
        .guest-meta {
            font-size: 0.8rem;
            color: #888;
        }

        /* ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜ & ì„¹ì…˜ ê°„ê²© ì¡°ì • */
        .fade-in-section {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
            will-change: opacity, transform;
            margin-bottom: 80px; /* [ìˆ˜ì •] ê° ì„¹ì…˜ ì‚¬ì´ë¥¼ ë„‰ë„‰í•˜ê²Œ ë„ì›€ (ì—”í„° 2~3ë²ˆ ê°„ê²©) */
        }
        .fade-in-section.is-visible {
            opacity: 1;
            transform: none;
        }
    </style>
</head>
<body>

<div class="container px-0">
    
    <!-- [ì„¹ì…˜ 1: ë©”ì¸] -->
    <div class="poster-wrapper fade-in-section">
        <img src="poster5.jpg" onerror="this.src='https://placehold.co/600x800/222/FFF?text=Da+JungHan+Band'" class="poster-img" alt="ê³µì—° í¬ìŠ¤í„°">
        <div class="p-4 bg-gradient-dark">
            <h1 class="fw-bold display-6">2026 GROOVE<br>MUSIC LIVE</h1>
            <p class="text-secondary mt-2">ë‹¹ì‹ ì˜ ê²¨ìš¸ì„ ëœ¨ê²ê²Œ ë‹¬êµ´ ìµœê³ ì˜ ë¬´ëŒ€.<br>[ë‹¤' ì •í•œ ë°´ë“œ] ê³µì—°ì— ì´ˆëŒ€í•©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <div class="px-3">
        <!-- [ì„¹ì…˜ 2: ìƒì„¸ ì •ë³´] -->
        <div class="fade-in-section">
            <div class="section-title">ê³µì—° ì •ë³´</div>
            <div class="info-box">
                <div class="mb-3">
                    <label class="text-secondary small">ì¼ì‹œ</label>
                    <div class="fs-5 fw-bold">2026ë…„ 1ì›” 3ì¼ (í† )</div>
                    <div class="fs-5">ì˜¤í›„ 5ì‹œ ~ 7ì‹œ</div>
                </div>
                
                <div class="mb-4">
                    <label class="text-secondary small">ì¥ì†Œ</label>
                    <div class="fw-bold">ì„œìš¸ ì¤‘ë‘êµ¬ ë™ì¼ë¡œ 711 ì§€í•˜ 1ì¸µ</div>
                    <div>ê·¸ë£¨ë¸Œë®¤ì§ìŠ¤íŠœë””ì˜¤</div>
                    <div class="mt-2">
                        <a href="https://map.naver.com/p/entry/place/1399123418?placePath=%252Fhome%253Fentry%253Dplt&searchType=place&lng=127.0799167&lat=37.5940504" target="_blank" class="btn btn-naver w-100 btn-sm">ğŸ“ ë„¤ì´ë²„ ì§€ë„ ë°”ë¡œê°€ê¸°</a>
                    </div>
                </div>

                <div class="alert alert-dark border-secondary" role="alert">
                    <h6 class="fw-bold text-black mb-2">âš ï¸ ì•ˆë‚´ì‚¬í•­</h6>
                    <ul class="notice-list ps-3 mb-0">
                        <li>ğŸ¤ ì™¸ë¶€ ìŒì‹ ë°˜ì… ê°€ëŠ¥í•©ë‹ˆë‹¤.<br><span class="text-secondary small">(ë°°ë‹¬ë„ ê°€ëŠ¥í•˜ë‚˜ ê°€ê¸‰ì  í¬ì¥ ì´ìš©í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.)</span></li>
                        <li>ğŸ¤ ì“°ë ˆê¸°ëŠ” ë´‰íˆ¬ì— ë¶„ë¦¬ìˆ˜ê±° í•´ì£¼ì„¸ìš”.</li>
                        <li>ğŸ¤ ì¢Œì„ì€ ì„ ì°©ìˆœìœ¼ë¡œ ì§€ì •ë©ë‹ˆë‹¤.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- [ì„¹ì…˜ 3: ì°¸ì—¬ ì—¬ë¶€ ì ‘ìˆ˜ (RSVP)] -->
        <div class="fade-in-section">
            <div class="section-title">ì°¸ì—¬ ì—¬ë¶€ ì ‘ìˆ˜</div>
            <div class="info-box">
                <div class="mb-3">
                    <label for="inviterSelect" class="form-label text-secondary small">ì´ˆëŒ€ ì§€ì¸ ì´ë¦„</label>
                    <select id="inviterSelect" class="form-select">
                        <option selected disabled value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                        <option value="ê¹€ë¯¼ìˆ˜">ê¹€ë¯¼ìˆ˜</option>
                        <option value="ê¹€ë¯¼ì£¼">ê¹€ë¯¼ì£¼</option>
                        <option value="ê¹€ì¤€ë²”">ê¹€ì¤€ë²”</option>
                        <option value="ë°•ë‹¤ì€">ë°•ë‹¤ì€</option>
                        <option value="ì†¡íƒœê´€">ì†¡íƒœê´€</option>
                        <option value="ì´ì„í˜•">ì´ì„í˜•</option>
                        <option value="í™©ê²¸">í™©ê²¸</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="visitorName" class="form-label text-secondary small">ë³¸ì¸ ì´ë¦„ (ì‹¤ëª…)</label>
                    <input type="text" class="form-control" id="visitorName" placeholder="ì‹¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" maxlength="10">
                    <div class="form-text text-secondary" style="font-size: 0.75rem;">
                        * ì •í™•í•œ ì‹¤ëª… ì…ë ¥ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
                    </div>
                </div>
                <button id="btnRsvp" class="btn btn-primary w-100">ì°¸ì—¬ ë“±ë¡í•˜ê¸°</button>
            </div>
        </div>

        <!-- [ì„¹ì…˜ 4: ë°©ëª…ë¡] -->
        <!-- ë°©ëª…ë¡ ì…ë ¥í¼ê³¼ ë¦¬ìŠ¤íŠ¸ë¥¼ í•˜ë‚˜ì˜ fade-in-sectionìœ¼ë¡œ ë¬¶ì–´ì„œ í•¨ê»˜ ë‚˜íƒ€ë‚˜ê²Œ í•¨ -->
        <div class="fade-in-section">
            <div class="section-title">ë°©ëª…ë¡</div>
            <div class="info-box mb-4">
                <div class="row g-2 mb-2">
                    <div class="col-4">
                        <input type="text" class="form-control" id="guestName" placeholder="ë‹‰ë„¤ì„" maxlength="10">
                    </div>
                    <div class="col-8">
                        <input type="text" class="form-control" id="guestContent" placeholder="ë‚´ìš©" maxlength="200">
                    </div>
                </div>
                <div class="form-text text-secondary mb-2" style="font-size: 0.75rem;">
                    * ê°œì¸ì •ë³´ ë…¸ì¶œ, ìš•ì„¤ ë“± ë¶€ì ì ˆí•œ ë‚´ìš©ì€ ì‚¼ê°€í•´ì£¼ì„¸ìš”.
                </div>
                <button id="btnGuestbook" class="btn btn-outline-light w-100 btn-sm">ë“±ë¡</button>
            </div>

            <!-- ë°©ëª…ë¡ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ -->
            <div id="guestbookList">
                <div class="text-center text-secondary py-3">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
            
            <!-- ë”ë³´ê¸° ë²„íŠ¼ -->
            <div class="text-center mt-3">
                <button id="btnLoadMore" class="btn btn-dark btn-sm rounded-pill px-4" style="display: none;">
                    ğŸ‘‡ ë” ë³´ê¸°
                </button>
            </div>
        </div>

    </div>

    <footer class="text-center text-secondary small mt-5 pt-3 border-top border-dark">
        &copy; 2026 ë‹¤' ì •í•œ ë°´ë“œ
    </footer>
</div>

<!-- ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1 
        };

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target); 
                }
            });
        }, observerOptions);

        const sections = document.querySelectorAll('.fade-in-section');
        sections.forEach(section => {
            observer.observe(section);
        });
    });
</script>

<!-- Firebase Modular SDK -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { 
        getFirestore, 
        collection, 
        addDoc, 
        query, 
        where, 
        getDocs, 
        orderBy, 
        limit, 
        onSnapshot, 
        serverTimestamp 
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAXBBLO3VVvrA3cNmcRLlrkEJdJqdLbjUo",
      authDomain: "band-concert-invite.firebaseapp.com",
      projectId: "band-concert-invite",
      storageBucket: "band-concert-invite.firebasestorage.app",
      messagingSenderId: "249455279668",
      appId: "1:249455279668:web:27c0d16d9c2cf987df9461",
      measurementId: "G-YDFCDHJJ71"
    };

    let app, db;
    try {
        app = initializeApp(firebaseConfig);
        db = getFirestore(app);
    } catch (e) {
        console.error("Firebase ì´ˆê¸°í™” ì‹¤íŒ¨. configë¥¼ í™•ì¸í•˜ì„¸ìš”.", e);
        alert("ì‹œìŠ¤í…œ ì˜¤ë¥˜: Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.");
    }

    // [ê¸°ëŠ¥ 1] ì°¸ì—¬ ì—¬ë¶€ ì ‘ìˆ˜
    const btnRsvp = document.getElementById("btnRsvp");
    
    btnRsvp.addEventListener("click", async () => {
        const inviter = document.getElementById("inviterSelect").value;
        const visitor = document.getElementById("visitorName").value.trim();

        if (!inviter) return alert("ì´ˆëŒ€ ì§€ì¸ ì´ë¦„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
        if (!visitor) return alert("ë³¸ì¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        if (visitor.length > 10) return alert("ì´ë¦„ì€ 10ìë¥¼ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

        btnRsvp.disabled = true;
        btnRsvp.innerText = "ì²˜ë¦¬ ì¤‘...";

        try {
            const rsvpRef = collection(db, "rsvps");
            const q = query(rsvpRef, where("visitor", "==", visitor));
            const querySnapshot = await getDocs(q);

            if (!querySnapshot.empty) {
                alert(`'${visitor}'ë‹˜ì€ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤!`);
                btnRsvp.disabled = false;
                btnRsvp.innerText = "ì°¸ì—¬ ë“±ë¡í•˜ê¸°";
                return;
            }

            await addDoc(rsvpRef, {
                inviter: inviter,
                visitor: visitor,
                createdAt: serverTimestamp()
            });

            alert("âœ… ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤! ê³µì—°ì¥ì—ì„œ ëµ™ê² ìŠµë‹ˆë‹¤.");
            document.getElementById("visitorName").value = "";
            
        } catch (error) {
            console.error("Error adding RSVP: ", error);
            if(error.code === 'permission-denied') {
                alert("ì €ì¥ ì‹¤íŒ¨: ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. (íŒŒì´ì–´ë² ì´ìŠ¤ ê·œì¹™ì„ í™•ì¸í•˜ì„¸ìš”)");
            } else if (error.code === 'unavailable') {
                alert("ì €ì¥ ì‹¤íŒ¨: ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
            } else {
                alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
            }
        } finally {
            btnRsvp.disabled = false;
            btnRsvp.innerText = "ì°¸ì—¬ ë“±ë¡í•˜ê¸°";
        }
    });

    // [ê¸°ëŠ¥ 2] ë°©ëª…ë¡
    const btnGuestbook = document.getElementById("btnGuestbook");
    const listContainer = document.getElementById("guestbookList");
    const btnLoadMore = document.getElementById("btnLoadMore");
    
    let currentLimit = 8; 
    let unsubscribe = null; 

    btnGuestbook.addEventListener("click", async () => {
        const nickname = document.getElementById("guestName").value.trim();
        const content = document.getElementById("guestContent").value.trim();

        if (!nickname || !content) return alert("ë‹‰ë„¤ì„ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        if (nickname.length > 10) return alert("ë‹‰ë„¤ì„ì€ 10ì ì´ë‚´ì—¬ì•¼ í•©ë‹ˆë‹¤.");
        if (content.length > 200) return alert("ë‚´ìš©ì€ 200ì ì´ë‚´ì—¬ì•¼ í•©ë‹ˆë‹¤.");

        try {
            await addDoc(collection(db, "guestbook"), {
                nickname: nickname,
                content: content,
                createdAt: serverTimestamp()
            });
            document.getElementById("guestName").value = "";
            document.getElementById("guestContent").value = "";
        } catch (error) {
            console.error("Error adding guestbook: ", error);
            if(error.code === 'permission-denied') {
                alert("ë“±ë¡ ì‹¤íŒ¨: ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
            } else {
                alert("ë°©ëª…ë¡ ë“±ë¡ ì‹¤íŒ¨: " + error.message);
            }
        }
    });

    function loadGuestbook() {
        if (unsubscribe) unsubscribe();

        const q = query(
            collection(db, "guestbook"),
            orderBy("createdAt", "desc"),
            limit(currentLimit)
        );

        unsubscribe = onSnapshot(q, (snapshot) => {
            listContainer.innerHTML = "";

            if (snapshot.empty) {
                listContainer.innerHTML = '<div class="text-center text-secondary py-3">ì•„ì§ ì‘ì„±ëœ ë°©ëª…ë¡ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ê¸€ì˜ ì£¼ì¸ê³µì´ ë˜ì–´ë³´ì„¸ìš”!</div>';
                btnLoadMore.style.display = "none";
                return;
            }

            snapshot.forEach((doc) => {
                const data = doc.data();
                const date = data.createdAt ? data.createdAt.toDate() : new Date();
                const dateString = `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;

                const safeNickname = escapeHtml(data.nickname);
                const safeContent = escapeHtml(data.content);

                const cardHtml = `
                    <div class="guestbook-card">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <strong class="text-warning">${safeNickname}</strong>
                            <span class="guest-meta">${dateString}</span>
                        </div>
                        <div class="text-break" style="white-space: pre-wrap; font-size: 0.95rem;">${safeContent}</div>
                    </div>
                `;
                listContainer.innerHTML += cardHtml;
            });

            if (snapshot.docs.length >= currentLimit) {
                btnLoadMore.style.display = "inline-block";
            } else {
                btnLoadMore.style.display = "none";
            }
        }, (error) => {
            console.error("Error fetching guestbook: ", error);
            if (error.code === 'permission-denied') {
                listContainer.innerHTML = `<div class="alert alert-danger">ë°ì´í„° ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.<br>íŒŒì´ì–´ë² ì´ìŠ¤ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.</div>`;
            } else if (error.code === 'failed-precondition') {
                 listContainer.innerHTML = `<div class="alert alert-danger">ì¿¼ë¦¬ ì˜¤ë¥˜ì…ë‹ˆë‹¤.</div>`;
            } else {
                listContainer.innerHTML = `<div class="text-center text-danger py-3">ë¡œë”© ì‹¤íŒ¨<br>(${error.message})</div>`;
            }
        });
    }

    btnLoadMore.addEventListener("click", () => {
        currentLimit += 8;
        loadGuestbook();
    });

    loadGuestbook();

    function escapeHtml(text) {
        if (!text) return "";
        return text
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }

</script>
</body>
</html>